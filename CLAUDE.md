# CLAUDE.md

This file provides guidance for AI assistants working with this codebase.

## Project Overview

This is a full-stack React authentication starter using TanStack Start, Convex, and Better Auth. It demonstrates SSR-compatible authentication with real-time database features.

## Architecture

### Frontend (`src/`)

- **Framework**: TanStack Start (SSR-capable React framework built on TanStack Router)
- **Routing**: File-based routing in `src/routes/`
- **State Management**: TanStack Query integrated with Convex via `@convex-dev/react-query`
- **UI Components**: HeroUI (React component library)
- **Styling**: Tailwind CSS v4

### Backend (`convex/`)

- **Database**: Convex (real-time serverless database)
- **Authentication**: Better Auth with Convex adapter (`@convex-dev/better-auth`)
- **API**: Convex functions (queries, mutations, actions)

## Key Files

### Frontend

| File | Purpose |
|------|---------|
| `src/router.tsx` | Router configuration with Convex + TanStack Query integration |
| `src/routes/__root.tsx` | Root layout with SSR auth token handling |
| `src/routes/index.tsx` | Home page with sign-in/sign-up form |
| `src/routes/api/auth/$.ts` | API route handler for Better Auth |
| `src/lib/auth-client.ts` | Better Auth client configuration |
| `src/lib/auth-server.ts` | Server-side auth utilities for SSR |

### Backend (Convex)

| File | Purpose |
|------|---------|
| `convex/auth.ts` | Better Auth configuration with Convex adapter |
| `convex/auth.config.ts` | Auth component configuration |
| `convex/http.ts` | HTTP router for auth endpoints |
| `convex/convex.config.ts` | Convex component configuration |

## Development Commands

```bash
# Start dev server
bun run dev

# Run Convex dev (required for backend)
bunx convex dev

# Lint and type check
bun run check

# Auto-fix lint issues
bun run fix
```

## Code Style

- **Linter/Formatter**: oxlint + oxfmt (strict configuration)
- **Language**: TypeScript with strict mode
- All lint categories are set to `error` level

## Important Conventions

### File Generation

Do not modify these auto-generated files:
- `src/routeTree.gen.ts` - Generated by TanStack Router
- `convex/_generated/*` - Generated by Convex

### Routing

- Use file-based routing in `src/routes/`
- API routes go in `src/routes/api/`
- Use `createFileRoute` for route definitions

### Authentication Flow

1. Client uses `authClient` from `src/lib/auth-client.ts`
2. API routes handled at `/api/auth/*` via TanStack Start
3. Convex HTTP endpoints handle token verification at `VITE_CONVEX_SITE_URL`
4. SSR auth tokens retrieved via `getToken()` in `src/lib/auth-server.ts`

### Convex Integration

- Use TanStack Query with `ConvexQueryClient` for data fetching
- Convex client wrapped in `ConvexBetterAuthProvider` for authenticated requests
- Server-side queries use `convexQueryClient.serverHttpClient` with auth token

### UI Components

- Use HeroUI components (`@heroui/react`)
- Follow Tailwind CSS v4 conventions for custom styling

## Environment Variables

Required environment variables:
- `VITE_CONVEX_URL` - Convex deployment URL
- `VITE_CONVEX_SITE_URL` - Convex HTTP site URL
- `SITE_URL` - Application URL (for Better Auth)

## Dependencies

### Core
- `@tanstack/react-start` - Full-stack React framework
- `@tanstack/react-router` - Type-safe routing
- `@tanstack/react-query` - Data fetching and caching
- `convex` - Real-time serverless database
- `better-auth` - Authentication library
- `@convex-dev/better-auth` - Convex adapter for Better Auth
- `@convex-dev/react-query` - Convex + TanStack Query integration
- `@heroui/react` - UI component library

### Dev Tools
- `vite` v8 (beta) - Build tool
- `oxlint` - Linter with type checking
- `oxfmt` - Formatter
- `@typescript/native-preview` - TypeScript 7 native compiler
